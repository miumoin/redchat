<!DOCTYPE html>
<html lang="en">
<head>
    <title>Redchat</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css'>
    <style type="text/css">
        #frame #sidepanel #bottom-bar button,#frame #sidepanel #search input,#frame .content .message-input .wrap input{font-family:proxima-nova,"Source Sans Pro",sans-serif}#frame{min-width:360px;height:100vh;min-height:300px;background:#E6EAEA}@media screen and (max-width:360px){#frame{width:100%;height:100vh}}#frame #sidepanel{float:left;min-width:280px;max-width:340px;width:40%;height:100%;background:#2c3e50;color:#f5f5f5;overflow:hidden;position:relative}#frame #sidepanel #profile{width:80%;margin:25px auto}@media screen and (max-width:735px){#frame #sidepanel{width:58px;min-width:58px}#frame #sidepanel #profile{width:100%;margin:0 auto;padding:5px 0 0;background:#32465a}}#frame #sidepanel #profile.expanded .wrap{height:210px;line-height:initial}#frame #sidepanel #profile.expanded .wrap p{margin-top:20px}#frame #sidepanel #profile.expanded .wrap i.expand-button{-moz-transform:scaleY(-1);-o-transform:scaleY(-1);-webkit-transform:scaleY(-1);transform:scaleY(-1);filter:FlipH;-ms-filter:"FlipH"}#frame #sidepanel #profile .wrap{height:60px;line-height:60px;overflow:hidden;-moz-transition:.3s height ease;-o-transition:.3s height ease;-webkit-transition:.3s height ease;transition:.3s height ease}@media screen and (max-width:735px){#frame #sidepanel #profile .wrap{height:55px}}#frame #sidepanel #profile .wrap img{width:50px;border-radius:50%;padding:3px;border:2px solid #e74c3c;height:auto;float:left;cursor:pointer;-moz-transition:.3s border ease;-o-transition:.3s border ease;-webkit-transition:.3s border ease;transition:.3s border ease}@media screen and (max-width:735px){#frame #sidepanel #profile .wrap img{width:40px;margin-left:4px}#frame #sidepanel #profile .wrap p{display:none}}#frame #sidepanel #profile .wrap img.online{border:2px solid #2ecc71}#frame #sidepanel #profile .wrap img.away{border:2px solid #f1c40f}#frame #sidepanel #profile .wrap img.busy{border:2px solid #e74c3c}#frame #sidepanel #profile .wrap img.offline{border:2px solid #95a5a6}#frame #sidepanel #profile .wrap p{float:left;margin-left:15px}#frame #sidepanel #profile .wrap i.expand-button{float:right;margin-top:23px;font-size:.8em;cursor:pointer;color:#435f7a}#frame #sidepanel #profile .wrap #status-options{position:absolute;opacity:0;visibility:hidden;width:150px;margin:70px 0 0;border-radius:6px;z-index:99;line-height:initial;background:#435f7a;-moz-transition:.3s all ease;-o-transition:.3s all ease;-webkit-transition:.3s all ease;transition:.3s all ease}@media screen and (max-width:735px){#frame #sidepanel #profile .wrap i.expand-button{display:none}#frame #sidepanel #profile .wrap #status-options{width:58px;margin-top:57px}}#frame #sidepanel #profile .wrap #status-options.active{opacity:1;visibility:visible;margin:75px 0 0}@media screen and (max-width:735px){#frame #sidepanel #profile .wrap #status-options.active{margin-top:62px}}#frame #sidepanel #profile .wrap #status-options:before{content:'';position:absolute;width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-bottom:8px solid #435f7a;margin:-8px 0 0 24px}#frame #sidepanel #profile .wrap #status-options ul{overflow:hidden;border-radius:6px}#frame #sidepanel #profile .wrap #status-options ul li{padding:15px 0 30px 18px;display:block;cursor:pointer}@media screen and (max-width:735px){#frame #sidepanel #profile .wrap #status-options:before{margin-left:23px}#frame #sidepanel #profile .wrap #status-options ul li{padding:15px 0 35px 22px}}#frame #sidepanel #profile .wrap #status-options ul li:hover{background:#496886}#frame #sidepanel #profile .wrap #status-options ul li span.status-circle{position:absolute;width:10px;height:10px;border-radius:50%;margin:5px 0 0}#frame #sidepanel #profile .wrap #status-options ul li span.status-circle:before{content:'';position:absolute;width:14px;height:14px;margin:-3px 0 0 -3px;background:0 0;border-radius:50%;z-index:0}#frame #sidepanel #profile .wrap #status-options ul li p{padding-left:12px}@media screen and (max-width:735px){#frame #sidepanel #profile .wrap #status-options ul li span.status-circle{width:14px;height:14px}#frame #sidepanel #profile .wrap #status-options ul li span.status-circle:before{height:18px;width:18px}#frame #sidepanel #profile .wrap #status-options ul li p{display:none}}#frame #sidepanel #profile .wrap #status-options ul li#status-online span.status-circle{background:#2ecc71}#frame #sidepanel #profile .wrap #status-options ul li#status-online.active span.status-circle:before{border:1px solid #2ecc71}#frame #sidepanel #profile .wrap #status-options ul li#status-away span.status-circle{background:#f1c40f}#frame #sidepanel #profile .wrap #status-options ul li#status-away.active span.status-circle:before{border:1px solid #f1c40f}#frame #sidepanel #profile .wrap #status-options ul li#status-busy span.status-circle{background:#e74c3c}#frame #sidepanel #profile .wrap #status-options ul li#status-busy.active span.status-circle:before{border:1px solid #e74c3c}#frame #sidepanel #profile .wrap #status-options ul li#status-offline span.status-circle{background:#95a5a6}#frame #sidepanel #profile .wrap #status-options ul li#status-offline.active span.status-circle:before{border:1px solid #95a5a6}#frame #sidepanel #profile .wrap #expanded{padding:100px 0 0;display:block;line-height:initial!important}#frame #sidepanel #profile .wrap #expanded label{float:left;clear:both;margin:0 8px 5px 0;padding:5px 0}#frame #sidepanel #profile .wrap #expanded input{border:none;margin-bottom:6px;background:#32465a;border-radius:3px;color:#f5f5f5;padding:7px;width:calc(100% - 43px)}#frame #sidepanel #profile .wrap #expanded input:focus,#frame #sidepanel #search input:focus{background:#435f7a;outline:0}#frame #sidepanel #search{border-top:1px solid #32465a;border-bottom:1px solid #32465a;font-weight:300}#frame #sidepanel #search label{position:absolute;margin:10px 0 0 20px}#frame #sidepanel #search input{padding:10px 0 10px 46px;width:calc(100% - 25px);border:none;background:#32465a;color:#f5f5f5}#frame #sidepanel #search input::-webkit-input-placeholder{color:#f5f5f5}#frame #sidepanel #search input::-moz-placeholder{color:#f5f5f5}#frame #sidepanel #search input:-ms-input-placeholder{color:#f5f5f5}#frame #sidepanel #search input:-moz-placeholder{color:#f5f5f5}#frame #sidepanel #contacts{height:calc(100% - 177px);overflow-y:scroll;overflow-x:hidden}@media screen and (max-width:735px){#frame #sidepanel #search{display:none}#frame #sidepanel #contacts{height:calc(100% - 149px);overflow-y:scroll;overflow-x:hidden}#frame #sidepanel #contacts::-webkit-scrollbar{display:none}}#frame #sidepanel #contacts.expanded{height:calc(100% - 334px)}#frame #sidepanel #contacts::-webkit-scrollbar{width:8px;background:#2c3e50}#frame #sidepanel #contacts::-webkit-scrollbar-thumb{background-color:#243140}#frame #sidepanel #contacts ul li.contact{position:relative;padding:10px 0 15px;font-size:.9em;cursor:pointer}#frame #sidepanel #contacts ul li.contact:hover{background:#32465a}#frame #sidepanel #contacts ul li.contact.active{background:#32465a;border-right:5px solid #435f7a}#frame #sidepanel #contacts ul li.contact.active span.contact-status{border:2px solid #32465a!important}#frame #sidepanel #contacts ul li.contact .wrap{width:88%;margin:0 auto;position:relative}@media screen and (max-width:735px){#frame #sidepanel #contacts ul li.contact{padding:6px 0 46px 8px}#frame #sidepanel #contacts ul li.contact .wrap{width:100%}}#frame #sidepanel #contacts ul li.contact .wrap span{position:absolute;left:0;margin:-2px 0 0 -2px;width:10px;height:10px;border-radius:50%;border:2px solid #2c3e50;background:#95a5a6}#frame #sidepanel #contacts ul li.contact .wrap span.online{background:#2ecc71}#frame #sidepanel #contacts ul li.contact .wrap span.away{background:#f1c40f}#frame #sidepanel #contacts ul li.contact .wrap span.busy{background:#e74c3c}#frame #sidepanel #contacts ul li.contact .wrap img{width:40px;border-radius:50%;float:left;margin-right:10px}#frame #sidepanel #contacts ul li.contact .wrap .meta{padding:5px 0 0}@media screen and (max-width:735px){#frame #sidepanel #contacts ul li.contact .wrap img{margin-right:0}#frame #sidepanel #contacts ul li.contact .wrap .meta{display:none}}#frame #sidepanel #contacts ul li.contact .wrap .meta .name{font-weight:600}#frame #sidepanel #contacts ul li.contact .wrap .meta .preview{margin:5px 0 0;padding:0 0 1px;font-weight:400;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;-moz-transition:1s all ease;-o-transition:1s all ease;-webkit-transition:1s all ease;transition:1s all ease}#frame #sidepanel #contacts ul li.contact .wrap .meta .preview span{position:initial;border-radius:initial;background:0 0;border:none;padding:0 2px 0 0;margin:0 0 0 1px;opacity:.5}#frame #sidepanel #bottom-bar{position:absolute;width:100%;bottom:0}#frame #sidepanel #bottom-bar button{float:left;border:none;width:50%;padding:10px 0;background:#32465a;color:#f5f5f5;cursor:pointer;font-size:.85em}#frame #sidepanel #bottom-bar button:focus{outline:0}#frame #sidepanel #bottom-bar button:nth-child(1){border-right:1px solid #2c3e50}#frame #sidepanel #bottom-bar button:hover{background:#435f7a}#frame #sidepanel #bottom-bar button i{margin-right:3px;font-size:1em}@media screen and (max-width:735px){#frame #sidepanel #bottom-bar button{float:none;width:100%;padding:15px 0}#frame #sidepanel #bottom-bar button:nth-child(1){border-right:none;border-bottom:1px solid #2c3e50}#frame #sidepanel #bottom-bar button i{font-size:1.3em}#frame #sidepanel #bottom-bar button span{display:none}}#frame .content{float:right;width:60%;height:100%;overflow:hidden;position:relative}@media screen and (max-width:735px){#frame .content{width:calc(100% - 58px);min-width:300px!important}}@media screen and (min-width:900px){#frame .content{width:calc(100% - 340px)}}#frame .content .contact-profile{width:100%;height:60px;line-height:60px;background:#f5f5f5}#frame .content .contact-profile img{width:40px;border-radius:50%;float:left;margin:9px 12px 0 9px}#frame .content .contact-profile p{float:left}#frame .content .contact-profile .social-media{float:right}#frame .content .contact-profile .social-media i{margin-left:14px;cursor:pointer}#frame .content .contact-profile .social-media i:nth-last-child(1){margin-right:20px}#frame .content .contact-profile .social-media i:hover{color:#435f7a}#frame .content .messages{height:auto;min-height:calc(100% - 93px);max-height:calc(100% - 93px);overflow-y:scroll;overflow-x:hidden}#frame .content .messages::-webkit-scrollbar{width:8px;background:0 0}#frame .content .messages::-webkit-scrollbar-thumb{background-color:rgba(0,0,0,.3)}#frame .content .messages ul li{display:inline-block;clear:both;float:left;margin:15px 15px 5px;width:calc(100% - 25px);font-size:.9em}#frame .content .messages ul li:nth-last-child(1){margin-bottom:20px}#frame .content .messages ul li.sent img{margin:6px 8px 0 0}#frame .content .messages ul li.sent p{background:#435f7a;color:#f5f5f5}#frame .content .messages ul li.replies img{float:right;margin:6px 0 0 8px}#frame .content .messages ul li.replies p{background:#f5f5f5;float:right}#frame .content .messages ul li img{width:22px;border-radius:50%;float:left}#frame .content .messages ul li p{display:inline-block;padding:10px 15px;border-radius:20px;max-width:205px;line-height:130%}@media screen and (min-width:735px){#frame .content .messages ul li p{max-width:300px}}#frame .content .message-input{position:absolute;bottom:0;width:100%;z-index:99;padding-left:10px;padding-right:10px;padding-bottom:10px}#frame .content .message-input .wrap{position:relative}#frame .content .message-input .wrap input{float:left;border:none;width:calc(100% - 90px);padding:11px 32px 10px 8px;font-size:.8em;color:#32465a}#frame .content .message-input .wrap input:focus{outline:0}#frame .content .message-input .wrap .attachment{position:absolute;right:60px;z-index:4;margin-top:10px;font-size:1.1em;color:#435f7a;opacity:.5;cursor:pointer}@media screen and (max-width:735px){#frame .content .messages{max-height:calc(100% - 105px)}#frame .content .message-input .wrap input{padding:15px 32px 16px 8px}#frame .content .message-input .wrap .attachment{margin-top:17px;right:65px}}#frame .content .message-input .wrap .attachment:hover{opacity:1}#frame .content .message-input .wrap button{float:right;border:none;width:50px;padding:12px 0;cursor:pointer;background:#32465a;color:#f5f5f5}@media screen and (max-width:735px){#frame .content .message-input .wrap button{padding:16px 0}}#frame .content .message-input .wrap button:hover{background:#435f7a}#frame .content .message-input .wrap button:focus{outline:0}body{margin:0 auto}
        .chat_selected{
            padding: 10px;
            background-color: #598672;
    		color: #fff;
        }
        .chat_selected a{
        	color: #fff !important;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    
	<script type="text/javascript">
		$(function() {
            if(window.location.hash) {
              var br = window.location.hash.split('#');
              if( br[1] != undefined ) {
                var hashed_public_key = br[1];
                $("#public_key").val(hashed_public_key);
                window.location.hash = '';
              }
            }
			start_chat_with_this_user();
		});
	</script>

    <script type="text/javascript">
        var base = 'http://dinocommerce.com/redchat';
        var fetch_text_array = new Array();
        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays*24*60*60*1000));
            var expires = "expires="+ d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }
        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for(var i = 0; i <ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function fetch_text(recipient_private_key,sender_public_key){
            var url = base + '/api/fetch';
            var data = {recipient_private_key:recipient_private_key,sender_public_key:sender_public_key};
            var jqXHR = $.ajax({
                type: "POST",
                url: url,
                data:data,
                async:false,
                success: function (res){
                    console.log(res);
                }
            });
            return jqXHR.responseText;
        }

        function send_text(sender_private_key,recipient_public_key,message,attachment_type,attachment){
            var url = base + '/api/send';
            var data = {sender_private_key:sender_private_key,recipient_public_key:recipient_public_key,message:message,attachment_type:attachment_type,attachment:attachment};
            $.ajax({
                type: "POST",
                url: url,
                data:data,
                success: function (res){
                    res = JSON.parse(res);
                    return res;
                }
            });

        }

        function start_chat_with_this_user(){
            console.log("hello");
            var res = fetch_text(getCookie('redchat_private_key'),$("#public_key").val());
            
            res = JSON.parse(res);
            console.log(res);
            if (res.status == '105') {
                alert("sorry node not found");
            }else{
                if(getCookie('redchat_public_key_array') == ''){
                    $(".chat_selected").removeClass("chat_selected");
                    var redchat_public_key_array = [];
                    redchat_public_key_array.unshift($("#public_key").val());
                    setCookie('redchat_public_key_array', JSON.stringify(redchat_public_key_array), 1);
                    var html = '<li class="chat_selected" onclick="show_chat_for_this_user(\''+$("#public_key").val()+'\',this)"><a >'+$("#public_key").val()+'</a></li>';
                    $("#nav_user").prepend(html);
                    $("#current_person_to_chat").val($("#public_key").val());
                    if (res.messages != null) {
                        for (var i = 0; i < res.messages.length; i++) {
                            save_to_chat_data($("#public_key").val(),res.messages[i].message,1);
                        }
                        populate_chat_html($("#public_key").val());
                    }
                }else{
                    var redchat_public_key_array = JSON.parse(getCookie('redchat_public_key_array'));
                    if(redchat_public_key_array.includes($("#public_key").val()) == false){
                        $(".chat_selected").removeClass("chat_selected");
                        var html = '<li class="chat_selected" onclick="show_chat_for_this_user(\''+$("#public_key").val()+'\',this)"><a >'+$("#public_key").val()+'</a></li>';
                        $("#nav_user").prepend(html);
                        redchat_public_key_array.unshift($("#public_key").val());
                        setCookie('redchat_public_key_array', JSON.stringify(redchat_public_key_array), 1);
                        $("#current_person_to_chat").val($("#public_key").val());
                        if (res.messages != null) {
                            for (var i = 0; i < res.messages.length; i++) {
                                save_to_chat_data($("#public_key").val(),res.messages[i].message,1);
                            }
                            populate_chat_html($("#public_key").val());

                        }
                    }
                }
            }
            fetch_text_for_user($("#current_person_to_chat").val());
        }

        function show_chat_for_this_user(key,me){
            $(".chat_selected").removeClass("chat_selected");
            $("#current_person_to_chat").val(key);
            me.classList.add("chat_selected");
            fetch_text_for_user($("#current_person_to_chat").val());
        }

        function send_this_text(){
            send_text(getCookie('redchat_private_key'),$("#current_person_to_chat").val(),$("#chat_new_text")[0].value,'','');
            save_to_chat_data($("#current_person_to_chat").val(),$("#chat_new_text")[0].value, 0);
            populate_chat_html($("#current_person_to_chat").val());
            fetch_text_for_user($("#current_person_to_chat").val());
            $("#chat_new_text")[0].value = '';
        }

        function save_to_chat_data(key,text,status){
            if (localStorage.getItem("chat_data_array") != null) {
                //array exist
                var flag = 0;
                var chat_data_array = JSON.parse(localStorage.getItem("chat_data_array"));
                for (var i = 0; i < chat_data_array.length; i++) {
                    if(chat_data_array[i].key == key){
                        flag = 1;
                        chat_data_array[i].text_array.splice(0, 0, {text:text, status:status});
                        if (chat_data_array[i].text_array.length > 5) {
                            chat_data_array[i].text_array.length = 5;
                        }
                    }
                }
                if(flag == 0){
                    var text_array = [{text:text, status:status}];
                    chat_data_array.push({ key : key, text_array : text_array});
                }
                localStorage.setItem("chat_data_array", JSON.stringify(chat_data_array));
            }else{
                //create array and insert
                var text_array = [{text:text, status:status}];
                var chat_data_array = [{ key : key, text_array : text_array}];
                localStorage.setItem("chat_data_array", JSON.stringify(chat_data_array));
                console.log(JSON.stringify(chat_data_array));
            }
        }

        function populate_chat_html(key){
            var html = '';
            var chat_data_array = JSON.parse(localStorage.getItem("chat_data_array"));
            for (var i = 0; i < chat_data_array.length; i++) {
                if(chat_data_array[i].key == key){
                    // for(var j=0;j<chat_data_array[i].text_array.length;j++){
                    //     console.log(chat_data_array[i].text_array[j]);
                    //     if(chat_data_array[i].text_array[j].status == '0'){
                    //         html += '<div class="chat_text_toggle"><span style="float: left; color: #39A2A1;">'+ chat_data_array[i].text_array[j].text +'</span></div><br>';
                    //     }else{
                    //         html += '<div class="chat_text_toggle"><span style="float: left; color: #C7021B;">'+ chat_data_array[i].text_array[j].text +'</span></div><br>';
                    //     }

                    // } 
                    for(var j= chat_data_array[i].text_array.length - 1;j>=0;j--){
                        console.log(chat_data_array[i].text_array[j]);
                        if(chat_data_array[i].text_array[j].status == '0'){
                            html += '<div class="chat_text_toggle"><span>You:  </span><span style="color: #39A2A1;">'+ chat_data_array[i].text_array[j].text +'</span></div><br>';
                        }else{
                            html += '<div class="chat_text_toggle"><span>John Doe:  </span><span style="color: #C7021B;">'+ chat_data_array[i].text_array[j].text +'</span></div><br>';
                        }
                    }
                }
            }
            $("#chat_text").html(html);
            return;
        }

        function fetch_text_for_user(key){
            if (fetch_text_array.indexOf(key) < 0) {
                fetch_text_array.push(key);
                setInterval(function(){ 
                    var res = fetch_text(getCookie('redchat_private_key'),key);
                    console.log("res");
                    console.log(res);
                    res = JSON.parse(res);
                    if (res.status == '106') {
                        if (res.messages != null) {
                            for (var i = 0; i < res.messages.length; i++) {
                                save_to_chat_data(key,res.messages[i].message,1);
                            }
                            populate_chat_html(key);
                        }
                    }
                }, 15000);
            }
            populate_chat_html($("#current_person_to_chat").val());
            
        }

        $(function() {
            var wage = document.getElementById("chat_new_text");
            wage.addEventListener("keydown", function (e) {
                if (e.keyCode === 13) {  //checks whether the pressed key is "Enter"
                    send_this_text();
                }
            });
            //redchat_private_key
            //redchat_public_key
            if(getCookie('redchat_private_key') != '' && getCookie('redchat_public_key') != ''){
                console.log('redchat_private_key-----'+getCookie('redchat_private_key'));
                $("#my_public_key").html(getCookie('redchat_public_key'));
                $("#my_private_key").html(getCookie('redchat_private_key'));
                console.log('redchat_public_key------'+getCookie('redchat_public_key'));
                if(getCookie('redchat_public_key_array') != ''){
                    var redchat_public_key_array = JSON.parse(getCookie('redchat_public_key_array'));
                    var html = '';
                    for (var i = 0; i < redchat_public_key_array.length; i++) {
                        if (i==0) {
                            $("#current_person_to_chat").val(redchat_public_key_array[i]);
                            fetch_text_for_user($("#current_person_to_chat").val());
                            html += '<li class="chat_selected" onclick="show_chat_for_this_user(\''+redchat_public_key_array[i]+'\',this)"><a>'+redchat_public_key_array[i]+'</a></li>';
                        }else{
                        	html += '<li onclick="show_chat_for_this_user(\''+redchat_public_key_array[i]+'\',this)"><a >'+redchat_public_key_array[i]+'</a></li>';
                    	}
                    }
                    $("#nav_user").prepend(html);
                }

            }else{
                var url = base + '/api/get_keys';
                $.ajax({
                    type: "POST",
                    url: url,
                    async:false,
                    success: function (res){
                        console.log(res);
                        res = JSON.parse(res);
                        setCookie('redchat_private_key', res.private_key, 1);
                        setCookie('redchat_public_key', res.public_key, 1);
                        $("#my_public_key").html(getCookie('redchat_public_key'));
                        $("#my_private_key").html(getCookie('redchat_private_key'));
                    }
                });
            }
        });
        function show_public_key(){
            alert("Your public key is :"+getCookie('redchat_public_key'));
        }
        function show_private_key(){
            alert("Your private key is :"+getCookie('redchat_private_key'));
        }
        function show_url(){
            var current_url = location.href.replace(location.hash,"").replace('#','');
            alert("Your chat url is : " + location.href.replace(location.hash,"").replace('#','') + "#" +getCookie('redchat_public_key'));
        }
        function fetch_new_public_key_from_db(){
        	var url = base + '/api/fetch_new_public_key';
        	var data = {key:getCookie('redchat_public_key')};
            $.ajax({
                type: "POST",
                url: url,
                async:false,
                success: function (res){
                    console.log(res);
                }
            });
        }
    </script>
</head>
<body>


    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">RED CHAT</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse" aria-expanded="false" style="height: 1px;">
                <ul class="nav navbar-nav">
                    <li class="active"><a onclick="show_public_key()">Show public key</a></li>
                    <li class="active"><a onclick="show_private_key()">Show private key</a></li>
                    <li class="active"><a onclick="show_url()">Show URL</a></li>
                </ul>
                <div class="navbar-form navbar-right">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Public key..." id="public_key">
                    </div>
                    <button type="button" class="btn btn-default" onclick="start_chat_with_this_user();">Start</button>
                </div>
            </div>
        </div>
    </nav>

    <div id="frame">
        <div id="sidepanel">
            <br>
            <br>
            <br>
            <div id="contacts">
                <ul id="nav_user" style="list-style-type:none;padding: 10px">
                    
                </ul>
            </div>
        </div>
        <div class="content">
            <div class="contact-profile">
                <p>Johm doe</p>
                <div class="social-media">
                    <i class="fa fa-facebook" aria-hidden="true"></i>
                    <i class="fa fa-twitter" aria-hidden="true"></i>
                    <i class="fa fa-instagram" aria-hidden="true"></i>
                </div>
            </div>
            <div class="messages">
                <div id="chat_text" style="padding-left: 10px;">
                    
                </div>
            </div>
            <div class="message-input">
                <div class="wrap">
                    <input type="text" id="chat_new_text" placeholder="Write your message..." />
                    <i class="fa fa-paperclip attachment" aria-hidden="true"></i>
                    <button class="submit" onclick="send_this_text();"><i class="fa fa-paper-plane" aria-hidden="true"></i></button>
                </div>
            </div>
        </div>
    </div>


<input type="text" id="current_person_to_chat" hidden>
</body>
</html>
